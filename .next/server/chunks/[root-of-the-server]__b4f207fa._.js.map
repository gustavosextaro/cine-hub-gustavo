{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gusta/OneDrive/Documentos/eugustavosextaroLP/cinehub/cinehub-main/src/app/api/analytics/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { promises as fs } from 'fs';\r\nimport path from 'path';\r\n\r\nconst DATA_FILE = path.join(process.cwd(), 'data', 'analytics.json');\r\n\r\ninterface AnalyticsEvent {\r\n  type: 'pageview' | 'click';\r\n  component?: string;\r\n  timestamp: number;\r\n  referrer?: string;\r\n  userAgent?: string;\r\n}\r\n\r\ninterface AnalyticsData {\r\n  events: AnalyticsEvent[];\r\n}\r\n\r\nasync function ensureDataFile() {\r\n  try {\r\n    await fs.mkdir(path.dirname(DATA_FILE), { recursive: true });\r\n    try {\r\n      await fs.access(DATA_FILE);\r\n    } catch {\r\n      // File doesn't exist, create it\r\n      await fs.writeFile(DATA_FILE, JSON.stringify({ events: [] }, null, 2));\r\n    }\r\n  } catch (error) {\r\n    console.error('Error ensuring data file:', error);\r\n  }\r\n}\r\n\r\nasync function readData(): Promise<AnalyticsData> {\r\n  try {\r\n    await ensureDataFile();\r\n    const data = await fs.readFile(DATA_FILE, 'utf-8');\r\n    return JSON.parse(data);\r\n  } catch (error) {\r\n    console.error('Error reading analytics data:', error);\r\n    return { events: [] };\r\n  }\r\n}\r\n\r\nasync function writeData(data: AnalyticsData) {\r\n  try {\r\n    await ensureDataFile();\r\n    await fs.writeFile(DATA_FILE, JSON.stringify(data, null, 2));\r\n  } catch (error) {\r\n    console.error('Error writing analytics data:', error);\r\n  }\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const event: AnalyticsEvent = await request.json();\r\n    \r\n    const data = await readData();\r\n    data.events.push(event);\r\n    \r\n    // Keep only last 10,000 events to prevent file from growing too large\r\n    if (data.events.length > 10000) {\r\n      data.events = data.events.slice(-10000);\r\n    }\r\n    \r\n    await writeData(data);\r\n    \r\n    return NextResponse.json({ success: true });\r\n  } catch (error) {\r\n    console.error('Analytics API error:', error);\r\n    return NextResponse.json({ error: 'Failed to track event' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET() {\r\n  try {\r\n    const data = await readData();\r\n    \r\n    // Calculate statistics\r\n    const now = Date.now();\r\n    const oneDayAgo = now - (24 * 60 * 60 * 1000);\r\n    const sevenDaysAgo = now - (7 * 24 * 60 * 60 * 1000);\r\n    \r\n    const totalPageviews = data.events.filter(e => e.type === 'pageview').length;\r\n    const todayPageviews = data.events.filter(e => \r\n      e.type === 'pageview' && e.timestamp > oneDayAgo\r\n    ).length;\r\n    const weekPageviews = data.events.filter(e => \r\n      e.type === 'pageview' && e.timestamp > sevenDaysAgo\r\n    ).length;\r\n    \r\n    // Count clicks by component\r\n    const clicksByComponent: Record<string, number> = {};\r\n    data.events\r\n      .filter(e => e.type === 'click' && e.component)\r\n      .forEach(e => {\r\n        const component = e.component!;\r\n        clicksByComponent[component] = (clicksByComponent[component] || 0) + 1;\r\n      });\r\n    \r\n    // Count referrers\r\n    const referrers: Record<string, number> = {};\r\n    data.events\r\n      .filter(e => e.type === 'pageview' && e.referrer)\r\n      .forEach(e => {\r\n        const ref = e.referrer!;\r\n        if (ref) {\r\n          const domain = new URL(ref).hostname || 'Direct';\r\n          referrers[domain] = (referrers[domain] || 0) + 1;\r\n        }\r\n      });\r\n    \r\n    // TikTok percentage\r\n    const tiktokViews = data.events.filter(e => \r\n      e.type === 'pageview' && e.referrer && e.referrer.includes('tiktok')\r\n    ).length;\r\n    const tiktokPercentage = totalPageviews > 0 \r\n      ? Math.round((tiktokViews / totalPageviews) * 100) \r\n      : 0;\r\n    \r\n    return NextResponse.json({\r\n      totalPageviews,\r\n      todayPageviews,\r\n      weekPageviews,\r\n      clicksByComponent,\r\n      referrers,\r\n      tiktokPercentage,\r\n      lastEvents: data.events.slice(-50).reverse(), // Last 50 events\r\n    });\r\n  } catch (error) {\r\n    console.error('Analytics GET error:', error);\r\n    return NextResponse.json({ error: 'Failed to fetch analytics' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAcnD,eAAe;IACb,IAAI;QACF,MAAM,yGAAE,CAAC,KAAK,CAAC,4GAAI,CAAC,OAAO,CAAC,YAAY;YAAE,WAAW;QAAK;QAC1D,IAAI;YACF,MAAM,yGAAE,CAAC,MAAM,CAAC;QAClB,EAAE,OAAM;YACN,gCAAgC;YAChC,MAAM,yGAAE,CAAC,SAAS,CAAC,WAAW,KAAK,SAAS,CAAC;gBAAE,QAAQ,EAAE;YAAC,GAAG,MAAM;QACrE;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;IAC7C;AACF;AAEA,eAAe;IACb,IAAI;QACF,MAAM;QACN,MAAM,OAAO,MAAM,yGAAE,CAAC,QAAQ,CAAC,WAAW;QAC1C,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO;YAAE,QAAQ,EAAE;QAAC;IACtB;AACF;AAEA,eAAe,UAAU,IAAmB;IAC1C,IAAI;QACF,MAAM;QACN,MAAM,yGAAE,CAAC,SAAS,CAAC,WAAW,KAAK,SAAS,CAAC,MAAM,MAAM;IAC3D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;IACjD;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,QAAwB,MAAM,QAAQ,IAAI;QAEhD,MAAM,OAAO,MAAM;QACnB,KAAK,MAAM,CAAC,IAAI,CAAC;QAEjB,sEAAsE;QACtE,IAAI,KAAK,MAAM,CAAC,MAAM,GAAG,OAAO;YAC9B,KAAK,MAAM,GAAG,KAAK,MAAM,CAAC,KAAK,CAAC,CAAC;QACnC;QAEA,MAAM,UAAU;QAEhB,OAAO,8KAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,8KAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,OAAO,MAAM;QAEnB,uBAAuB;QACvB,MAAM,MAAM,KAAK,GAAG;QACpB,MAAM,YAAY,MAAO,KAAK,KAAK,KAAK;QACxC,MAAM,eAAe,MAAO,IAAI,KAAK,KAAK,KAAK;QAE/C,MAAM,iBAAiB,KAAK,MAAM,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,YAAY,MAAM;QAC5E,MAAM,iBAAiB,KAAK,MAAM,CAAC,MAAM,CAAC,CAAA,IACxC,EAAE,IAAI,KAAK,cAAc,EAAE,SAAS,GAAG,WACvC,MAAM;QACR,MAAM,gBAAgB,KAAK,MAAM,CAAC,MAAM,CAAC,CAAA,IACvC,EAAE,IAAI,KAAK,cAAc,EAAE,SAAS,GAAG,cACvC,MAAM;QAER,4BAA4B;QAC5B,MAAM,oBAA4C,CAAC;QACnD,KAAK,MAAM,CACR,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,WAAW,EAAE,SAAS,EAC7C,OAAO,CAAC,CAAA;YACP,MAAM,YAAY,EAAE,SAAS;YAC7B,iBAAiB,CAAC,UAAU,GAAG,CAAC,iBAAiB,CAAC,UAAU,IAAI,CAAC,IAAI;QACvE;QAEF,kBAAkB;QAClB,MAAM,YAAoC,CAAC;QAC3C,KAAK,MAAM,CACR,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,cAAc,EAAE,QAAQ,EAC/C,OAAO,CAAC,CAAA;YACP,MAAM,MAAM,EAAE,QAAQ;YACtB,IAAI,KAAK;gBACP,MAAM,SAAS,IAAI,IAAI,KAAK,QAAQ,IAAI;gBACxC,SAAS,CAAC,OAAO,GAAG,CAAC,SAAS,CAAC,OAAO,IAAI,CAAC,IAAI;YACjD;QACF;QAEF,oBAAoB;QACpB,MAAM,cAAc,KAAK,MAAM,CAAC,MAAM,CAAC,CAAA,IACrC,EAAE,IAAI,KAAK,cAAc,EAAE,QAAQ,IAAI,EAAE,QAAQ,CAAC,QAAQ,CAAC,WAC3D,MAAM;QACR,MAAM,mBAAmB,iBAAiB,IACtC,KAAK,KAAK,CAAC,AAAC,cAAc,iBAAkB,OAC5C;QAEJ,OAAO,8KAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA;YACA;YACA;YACA;YACA,YAAY,KAAK,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,OAAO;QAC5C;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,8KAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF","debugId":null}}]
}