{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gusta/OneDrive/Documentos/eugustavosextaroLP/cinehub/cinehub-main/src/lib/firebase-admin.ts"],"sourcesContent":["import { initializeApp, getApps, cert } from 'firebase-admin/app';\r\nimport { getFirestore } from 'firebase-admin/firestore';\r\n\r\n// Initialize Firebase Admin\r\nif (!getApps().length) {\r\n  initializeApp({\r\n    credential: cert({\r\n      projectId: process.env.FIREBASE_PROJECT_ID,\r\n      clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\r\n      privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, '\\n'),\r\n    }),\r\n  });\r\n}\r\n\r\nexport const db = getFirestore();\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;;AAEA,4BAA4B;AAC5B,IAAI,CAAC,IAAA,2JAAO,IAAG,MAAM,EAAE;IACrB,IAAA,iKAAa,EAAC;QACZ,YAAY,IAAA,wJAAI,EAAC;YACf,WAAW,QAAQ,GAAG,CAAC,mBAAmB;YAC1C,aAAa,QAAQ,GAAG,CAAC,qBAAqB;YAC9C,YAAY,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,QAAQ;QAChE;IACF;AACF;AAEO,MAAM,KAAK,IAAA,4KAAY","debugId":null}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gusta/OneDrive/Documentos/eugustavosextaroLP/cinehub/cinehub-main/src/app/api/analytics/route.ts"],"sourcesContent":["import { db } from '@/lib/firebase-admin';\r\nimport { NextRequest } from 'next/server';\r\n\r\ninterface AnalyticsEvent {\r\n  type: 'pageview' | 'click';\r\n  timestamp: number;\r\n  userAgent: string;\r\n  referrer: string;\r\n  componentName?: string;\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const { type, component } = body;\r\n\r\n    const event: AnalyticsEvent = {\r\n      type,\r\n      timestamp: Date.now(),\r\n      userAgent: request.headers.get('user-agent') || 'Unknown',\r\n      referrer: request.headers.get('referer') || 'Direct',\r\n      ...(component && { componentName: component }),\r\n    };\r\n\r\n    // Save event to Firestore\r\n    await db.collection('analytics').add(event);\r\n\r\n    return Response.json({ success: true });\r\n  } catch (error) {\r\n    console.error('Analytics error:', error);\r\n    return Response.json({ success: false, error: 'Failed to save event' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET() {\r\n  try {\r\n    // Get all events from Firestore\r\n    const snapshot = await db.collection('analytics').get();\r\n    \r\n    if (snapshot.empty) {\r\n      return Response.json({\r\n        totalPageviews: 0,\r\n        todayPageviews: 0,\r\n        weekPageviews: 0,\r\n        clicksByComponent: {},\r\n        referrers: {},\r\n        tiktokPercentage: 0,\r\n      });\r\n    }\r\n\r\n    const events: AnalyticsEvent[] = snapshot.docs.map(doc => doc.data() as AnalyticsEvent);\r\n\r\n    // Calculate stats\r\n    const now = Date.now();\r\n    const oneDayAgo = now - (24 * 60 * 60 * 1000);\r\n    const oneWeekAgo = now - (7 * 24 * 60 * 60 * 1000);\r\n\r\n    const pageviews = events.filter(e => e.type === 'pageview');\r\n    const clicks = events.filter(e => e.type === 'click');\r\n\r\n    const totalPageviews = pageviews.length;\r\n    const todayPageviews = pageviews.filter(e => e.timestamp > oneDayAgo).length;\r\n    const weekPageviews = pageviews.filter(e => e.timestamp > oneWeekAgo).length;\r\n\r\n    // Count clicks by component\r\n    const clicksByComponent: Record<string, number> = {};\r\n    clicks.forEach(event => {\r\n      if (event.componentName) {\r\n        clicksByComponent[event.componentName] = (clicksByComponent[event.componentName] || 0) + 1;\r\n      }\r\n    });\r\n\r\n    // Count referrers\r\n    const referrers: Record<string, number> = {};\r\n    pageviews.forEach(event => {\r\n      let referrer = 'Direct';\r\n      if (event.referrer && event.referrer !== 'Direct') {\r\n        try {\r\n          const url = new URL(event.referrer);\r\n          referrer = url.hostname;\r\n        } catch {\r\n          referrer = 'Direct';\r\n        }\r\n      }\r\n      referrers[referrer] = (referrers[referrer] || 0) + 1;\r\n    });\r\n\r\n    // Calculate TikTok percentage\r\n    const tiktokViews = pageviews.filter(e => \r\n      e.referrer.toLowerCase().includes('tiktok')\r\n    ).length;\r\n    const tiktokPercentage = totalPageviews > 0 \r\n      ? Math.round((tiktokViews / totalPageviews) * 100)\r\n      : 0;\r\n\r\n    return Response.json({\r\n      totalPageviews,\r\n      todayPageviews,\r\n      weekPageviews,\r\n      clicksByComponent,\r\n      referrers,\r\n      tiktokPercentage,\r\n    });\r\n  } catch (error) {\r\n    console.error('Analytics fetch error:', error);\r\n    return Response.json({\r\n      totalPageviews: 0,\r\n      todayPageviews: 0,\r\n      weekPageviews: 0,\r\n      clicksByComponent: {},\r\n      referrers: {},\r\n      tiktokPercentage: 0,\r\n    }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}