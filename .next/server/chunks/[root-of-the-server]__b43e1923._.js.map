{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gusta/OneDrive/Documentos/eugustavosextaroLP/cinehub/cinehub-main/src/app/api/analytics/route.ts"],"sourcesContent":["import { kv } from '@vercel/kv';\r\nimport { NextRequest } from 'next/server';\r\n\r\ninterface AnalyticsEvent {\r\n  type: 'pageview' | 'click';\r\n  timestamp: number;\r\n  userAgent: string;\r\n  referrer: string;\r\n  componentName?: string;\r\n}\r\n\r\nconst ANALYTICS_KEY = 'analytics:events';\r\nconst MAX_EVENTS = 10000;\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const { type, componentName } = body;\r\n\r\n    const event: AnalyticsEvent = {\r\n      type,\r\n      timestamp: Date.now(),\r\n      userAgent: request.headers.get('user-agent') || 'Unknown',\r\n      referrer: request.headers.get('referer') || 'Direct',\r\n      ...(componentName && { componentName }),\r\n    };\r\n\r\n    // Add event to list\r\n    await kv.rpush(ANALYTICS_KEY, JSON.stringify(event));\r\n    \r\n    // Trim list to maintain max size\r\n    await kv.ltrim(ANALYTICS_KEY, -MAX_EVENTS, -1);\r\n\r\n    return Response.json({ success: true });\r\n  } catch (error) {\r\n    console.error('Analytics error:', error);\r\n    return Response.json({ success: false, error: 'Failed to save event' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function GET() {\r\n  try {\r\n    // Get all events from KV\r\n    const eventsData = await kv.lrange(ANALYTICS_KEY, 0, -1) as string[];\r\n    \r\n    if (!eventsData || eventsData.length === 0) {\r\n      return Response.json({\r\n        totalPageviews: 0,\r\n        todayPageviews: 0,\r\n        weekPageviews: 0,\r\n        clicksByComponent: {},\r\n        referrers: {},\r\n        tiktokPercentage: 0,\r\n      });\r\n    }\r\n\r\n    const events: AnalyticsEvent[] = eventsData.map(e => JSON.parse(e));\r\n\r\n    // Calculate stats\r\n    const now = Date.now();\r\n    const oneDayAgo = now - (24 * 60 * 60 * 1000);\r\n    const oneWeekAgo = now - (7 * 24 * 60 * 60 * 1000);\r\n\r\n    const pageviews = events.filter(e => e.type === 'pageview');\r\n    const clicks = events.filter(e => e.type === 'click');\r\n\r\n    const totalPageviews = pageviews.length;\r\n    const todayPageviews = pageviews.filter(e => e.timestamp > oneDayAgo).length;\r\n    const weekPageviews = pageviews.filter(e => e.timestamp > oneWeekAgo).length;\r\n\r\n    // Count clicks by component\r\n    const clicksByComponent: Record<string, number> = {};\r\n    clicks.forEach(event => {\r\n      if (event.componentName) {\r\n        clicksByComponent[event.componentName] = (clicksByComponent[event.componentName] || 0) + 1;\r\n      }\r\n    });\r\n\r\n    // Count referrers\r\n    const referrers: Record<string, number> = {};\r\n    pageviews.forEach(event => {\r\n      let referrer = 'Direct';\r\n      if (event.referrer && event.referrer !== 'Direct') {\r\n        try {\r\n          const url = new URL(event.referrer);\r\n          referrer = url.hostname;\r\n        } catch {\r\n          referrer = 'Direct';\r\n        }\r\n      }\r\n      referrers[referrer] = (referrers[referrer] || 0) + 1;\r\n    });\r\n\r\n    // Calculate TikTok percentage\r\n    const tiktokViews = pageviews.filter(e => \r\n      e.referrer.toLowerCase().includes('tiktok')\r\n    ).length;\r\n    const tiktokPercentage = totalPageviews > 0 \r\n      ? Math.round((tiktokViews / totalPageviews) * 100)\r\n      : 0;\r\n\r\n    return Response.json({\r\n      totalPageviews,\r\n      todayPageviews,\r\n      weekPageviews,\r\n      clicksByComponent,\r\n      referrers,\r\n      tiktokPercentage,\r\n    });\r\n  } catch (error) {\r\n    console.error('Analytics fetch error:', error);\r\n    return Response.json({\r\n      totalPageviews: 0,\r\n      todayPageviews: 0,\r\n      weekPageviews: 0,\r\n      clicksByComponent: {},\r\n      referrers: {},\r\n      tiktokPercentage: 0,\r\n    }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}